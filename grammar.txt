// no distinction between expressions and statements
// before eliminating left recursion
expr: primitive
    | ifExpr
    | whileExpr
    | varDecl
    | anonFunc
    | funcDef
    | varAssign
    | arrayLiteral
    | OPAREN expr CPAREN                                        // parenthesized expression
    | expr OPAREN optArgList CPAREN                             // function call
    | expr OPAREN optArgList CPAREN OBRACE optExprList CBRACE   // higher order function call
    | expr OSQBRACE expr CSQBRACE                               // array access
    | expr OPERATOR expr                                        // binary operator expression

// after removing left recursion
expr: primary metaExpr
    | ifExpr metaExpr
    | whileExpr metaExpr
    | varDecl metaExpr
    | anonFunc metaExpr
    | funcDef metaExpr
    | varAssign metaExpr
    | arrayLiteral metaExpr
    | OPAREN expr CPAREN metaExpr

metaExpr: OPAREN optArgList CPAREN metaExpr
        | OPAREN optArgList CPAREN OBRACE optExprList CBRACE metaExpr
        | OSQBRACE expr CSQBRACE metaExpr
        | operator expr metaExpr
        | EPSILON

returnExpr : RETURN expr

arrayLiteral : OSQBRACE optCommaExprList CSQBRACE

optArgList : EPSILON
           | argList

argList : expr
        | expr COMMA argList

optCommaExprList : EPSILON
                 | commaExprList

commaExprList : expr
              | expr COMMA commaExprList

varDecl : LET IDENTIFIER
        | LET IDENTIFIER EQUAL expression

varAssign : IDENTIFIER EQUAL expression

funcDef : DEF IDENTIFIER OPAREN optParamList CPAREN OBRACE optExprList CBRACE

optParamList : EPSILON
             | paramList

paramList : IDENTIFIER
          | IDENTIFIER COMMA paramList

optExpressionList : EPSILON
                 | exprList

exprList : expr
         | expr NEWLINE exprList
         | expr SEMICOLON exprList


ifStatement : IF OPAREN expression CPAREN OBRACE expressionList CBRACE optElse

optElse : EPSILON
        | ELSE ifStatement
        | ELSE OBRACE expressionList CBRACE

whileStatement : WHILE OPAREN expression CPAREN OBRACE expressionList CBRACE

primary : NUMBER
        | STRING
        | IDENTIFIER 

operator : PLUS
         | MINUS
         | TIMES
         | DIVIDE
         | AND
         | OR
         | XOR
         | BIT_AND
         | BIT_OR
         | BIT_XOR
         | DOUBLE_EQUAL
         | GREATER_THAN
         | LESS_THAN

anonymousFunction : LAMBDA OPAREN optParamList CPAREN OBRACE optExpressionList CBRACE
